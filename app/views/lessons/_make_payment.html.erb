<header class="page-header">
<h1>Complete Payment</h1>
</header>

<div class="complete-payment">
  <div class="col-md-12">
      <% if @lesson.transaction.nil? %>
      <%= render partial: 'transactions/form' %>
      <% else %>
        <%= form_tag charge_lesson_transaction_path(@lesson.transaction) do %>
          <article class="col-md-12">
            <% if flash[:error].present? %>
              <div id="error_explanation">
                <p><%= flash[:error] %></p>
              </div>
            <% end %>
            <ul class="payment-amounts">
              <li> Lesson fee: <%= number_to_currency(@lesson.price, precision: 2) %> </li>
              <li>Tip amount: <%= number_to_currency(@lesson.transaction.tip_amount*@lesson.price)%>
              <%= link_to 'Edit Tip', edit_transaction_path(@lesson.transaction), class: 'btn btn-default' %></li>
              <li>Total Lesson Cost: <%=number_to_currency(@lesson.transaction.final_amount)%></li>
              <li><span>After deducting your $25.00 reservation deposit, your remaining balance to be charged is <b><%= number_to_currency(@lesson.transaction.final_amount - 25)%>.</b></span></li>
            </ul>
          <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                  data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                  data-description="Lesson Payment"
                  data-name="Snow Schoolers"
                  data-image="https://s3.amazonaws.com/snowschoolers/SnowSchoolers-logo.png"
                  data-amount=<%= @lesson.transaction.final_amount.to_i - 25 %>00
                  data-locale="auto"
                  data-zip-code="true">
          </script>
          </article>
      <% end %>
      <% end %>
  </div>
</div>


