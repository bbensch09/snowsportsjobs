function simpleExtend(t,e){var s=e||{};for(var i in t)i in s||(s[i]=t[i]);return s}function triggerSimpleCustomEvent(t,e){if(jq)jq(t).trigger(e);else{var s=document.createEvent("CustomEvent");s.initCustomEvent(e,!0,!0,{}),t.dispatchEvent(s)}}function hasClass(t,e){return jq?jq(t).hasClass(e):t.classList.contains(e)}function Datepair(t,e){this.dateDelta=null,this.timeDelta=null,this._defaults={startClass:"start",endClass:"end",timeClass:"time",dateClass:"date",defaultDateDelta:0,defaultTimeDelta:36e5,anchor:"start",parseTime:function(t){return jq(t).timepicker("getTime")},updateTime:function(t,e){jq(t).timepicker("setTime",e)},setMinTime:function(t,e){jq(t).timepicker("option","minTime",e)},parseDate:function(t){return t.value&&jq(t).datepicker("getDate")},updateDate:function(t,e){jq(t).datepicker("update",e)}},this.container=t,this.settings=simpleExtend(this._defaults,e),this.startDateInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.dateClass),this.endDateInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.dateClass),this.startTimeInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.timeClass),this.endTimeInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.timeClass),this.refresh(),this._bindChangeHandler()}var _ONE_DAY=864e5,jq=window.Zepto||window.jQuery;Datepair.prototype={constructor:Datepair,option:function(t,e){if("object"==typeof t)this.settings=simpleExtend(this.settings,t);else if("string"==typeof t&&"undefined"!=typeof e)this.settings[t]=e;else if("string"==typeof t)return this.settings[t];this._updateEndMintime()},getTimeDiff:function(){var t=this.dateDelta+this.timeDelta;return!(t<0)||this.startDateInput&&this.endDateInput||(t+=_ONE_DAY),t},refresh:function(){if(this.startDateInput&&this.startDateInput.value&&this.endDateInput&&this.endDateInput.value){var t=this.settings.parseDate(this.startDateInput),e=this.settings.parseDate(this.endDateInput);t&&e&&(this.dateDelta=e.getTime()-t.getTime())}if(this.startTimeInput&&this.startTimeInput.value&&this.endTimeInput&&this.endTimeInput.value){var s=this.settings.parseTime(this.startTimeInput),i=this.settings.parseTime(this.endTimeInput);s&&i&&(this.timeDelta=i.getTime()-s.getTime(),this._updateEndMintime())}},remove:function(){this._unbindChangeHandler()},_bindChangeHandler:function(){jq?jq(this.container).on("change.datepair",jq.proxy(this.handleEvent,this)):this.container.addEventListener("change",this,!1)},_unbindChangeHandler:function(){jq?jq(this.container).off("change.datepair"):this.container.removeEventListener("change",this,!1)},handleEvent:function(t){this._unbindChangeHandler(),hasClass(t.target,this.settings.dateClass)?""!=t.target.value?(this._dateChanged(t.target),this._timeChanged(t.target)):this.dateDelta=null:hasClass(t.target,this.settings.timeClass)&&(""!=t.target.value?this._timeChanged(t.target):this.timeDelta=null),this._validateRanges(),this._updateEndMintime(),this._bindChangeHandler()},_dateChanged:function(t){if(this.startDateInput&&this.endDateInput){var e=this.settings.parseDate(this.startDateInput),s=this.settings.parseDate(this.endDateInput);if(e&&s)if("start"==this.settings.anchor&&hasClass(t,this.settings.startClass)){var i=new Date(e.getTime()+this.dateDelta);this.settings.updateDate(this.endDateInput,i)}else if("end"==this.settings.anchor&&hasClass(t,this.settings.endClass)){var i=new Date(s.getTime()-this.dateDelta);this.settings.updateDate(this.startDateInput,i)}else if(s<e){var a=hasClass(t,this.settings.startClass)?this.endDateInput:this.startDateInput,n=this.settings.parseDate(t);this.dateDelta=0,this.settings.updateDate(a,n)}else this.dateDelta=s.getTime()-e.getTime();else if(null!==this.settings.defaultDateDelta){if(e){var h=new Date(e.getTime()+this.settings.defaultDateDelta*_ONE_DAY);this.settings.updateDate(this.endDateInput,h)}else if(s){var r=new Date(s.getTime()-this.settings.defaultDateDelta*_ONE_DAY);this.settings.updateDate(this.startDateInput,r)}this.dateDelta=this.settings.defaultDateDelta*_ONE_DAY}else this.dateDelta=null}},_timeChanged:function(t){if(this.startTimeInput&&this.endTimeInput){var e=this.settings.parseTime(this.startTimeInput),s=this.settings.parseTime(this.endTimeInput);if(e&&s)if("start"==this.settings.anchor&&hasClass(t,this.settings.startClass)){var i=new Date(e.getTime()+this.timeDelta);this.settings.updateTime(this.endTimeInput,i),s=this.settings.parseTime(this.endTimeInput),this._doMidnightRollover(e,s)}else if("end"==this.settings.anchor&&hasClass(t,this.settings.endClass)){var i=new Date(s.getTime()-this.timeDelta);this.settings.updateTime(this.startTimeInput,i),e=this.settings.parseTime(this.startTimeInput),this._doMidnightRollover(e,s)}else{this._doMidnightRollover(e,s);var a,n;if(this.startDateInput&&this.endDateInput&&(a=this.settings.parseDate(this.startDateInput),n=this.settings.parseDate(this.endDateInput)),+a==+n&&s<e){var h=hasClass(t,this.settings.endClass)?this.endTimeInput:this.startTimeInput,r=hasClass(t,this.settings.startClass)?this.endTimeInput:this.startTimeInput,l=this.settings.parseTime(h);this.timeDelta=0,this.settings.updateTime(r,l)}else this.timeDelta=s.getTime()-e.getTime()}else if(null!==this.settings.defaultTimeDelta){if(e){var u=new Date(e.getTime()+this.settings.defaultTimeDelta);this.settings.updateTime(this.endTimeInput,u)}else if(s){var d=new Date(s.getTime()-this.settings.defaultTimeDelta);this.settings.updateTime(this.startTimeInput,d)}this.timeDelta=this.settings.defaultTimeDelta}else this.timeDelta=null}},_doMidnightRollover:function(t,e){if(this.startDateInput&&this.endDateInput){var s=this.settings.parseDate(this.endDateInput),i=this.settings.parseDate(this.startDateInput),a=e.getTime()-t.getTime(),n=e<t?_ONE_DAY:-1*_ONE_DAY;null!==this.dateDelta&&this.dateDelta+this.timeDelta<=_ONE_DAY&&this.dateDelta+a!=0&&(n>0||0!=this.dateDelta)&&(a>=0&&this.timeDelta<0||a<0&&this.timeDelta>=0)&&("start"==this.settings.anchor?(this.settings.updateDate(this.endDateInput,new Date(s.getTime()+n)),this._dateChanged(this.endDateInput)):"end"==this.settings.anchor&&(this.settings.updateDate(this.startDateInput,new Date(i.getTime()-n)),this._dateChanged(this.startDateInput))),this.timeDelta=a}},_updateEndMintime:function(){if("function"==typeof this.settings.setMinTime){var t=null;"start"==this.settings.anchor&&(!this.dateDelta||this.dateDelta<_ONE_DAY||this.timeDelta&&this.dateDelta+this.timeDelta<_ONE_DAY)&&(t=this.settings.parseTime(this.startTimeInput)),this.settings.setMinTime(this.endTimeInput,t)}},_validateRanges:function(){return this.startTimeInput&&this.endTimeInput&&null===this.timeDelta?void triggerSimpleCustomEvent(this.container,"rangeIncomplete"):this.startDateInput&&this.endDateInput&&null===this.dateDelta?void triggerSimpleCustomEvent(this.container,"rangeIncomplete"):void(!this.startDateInput||!this.endDateInput||this.dateDelta+this.timeDelta>=0?triggerSimpleCustomEvent(this.container,"rangeSelected"):triggerSimpleCustomEvent(this.container,"rangeError"))}};